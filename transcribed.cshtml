@{
    if (Request["email"]==null) {
        Response.Write("Must specify email address");
        Response.Close();
    }
     
    if (Request["RecordingUrl"]==null) {
        Response.Write("Must specify recording url");
        Response.Close();
    }
    
    if (Request["TranscriptionStatus"]==null) {
        Response.Write("Must specify transcription status");
        Response.Close();
    }
     
    System.Net.Mail.MailMessage mail = new System.Net.Mail.MailMessage();
    mail.From=new System.Net.Mail.MailAddress("help@twilio.com");
    mail.To.Add(Request["email"]);
    
    if (Request["TranscriptionStatus"].ToLower() != "completed") {
        mail.Subject = string.Format("Error transcribing voicemail from {0}", Request["Caller"]);
        mail.Body = string.Format("You have a new voicemail from {0}.\n\nClick this link to listen to the message:\n{1}",
            Request["Caller"],
            Request["RecordingUrl"]);
    } else {
        mail.Subject = string.Format("New voicemail from {0}", Request["Caller"]);
        mail.Body = string.Format("You have a new voicemail from {0}.\n\nText of the Twilio transcribed voicemail:\n{1}\n\nClick this link to listen to the message:\n{2}",
            Request["Caller"],
            Request["TranscriptionText"],
            Request["RecordingUrl"]);
    }

    System.Net.Mail.SmtpClient smtp = new System.Net.Mail.SmtpClient();
    smtp.Send(mail);
}